{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="card-title">Perekaman Hasil Backup Data</h4>
                    <button class="btn btn-primary" data-action="create" data-url="{% url 'backup_data_create' %}">
                        <i class="ri-add-line align-bottom me-1"></i> Rekam Backup
                    </button>
                </div>
                <div class="card-body">
                    <table id="datatable" class="table table-bordered dt-responsive nowrap table-striped align-middle" style="width:100%">
                        <thead>
                            <tr>
                                <th>No Tiket</th>
                                <th>Lokasi Backup</th>
                                <th>User Perekam</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Placeholder -->
<div class="modal fade" id="modal-form" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Content loaded via AJAX -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        var table = $('#datatable').DataTable({
            processing: true,
            serverSide: true,
            ajax: "{% url 'backup_data_data' %}",
            columns: [
                { data: 'no_tiket' },
                { data: 'lokasi_backup' },
                { data: 'user' },
                { data: 'actions', orderable: false, searchable: false }
            ],
            order: [[0, 'desc']]
        });

        // Handle Create/Edit buttons
        $(document).on('click', '[data-action="create"], [data-action="edit"]', function() {
            var url = $(this).data('url');
            $.get(url, { ajax: true }, function(data) {
                $('#modal-form .modal-content').html(data.html);
                $('#modal-form').modal('show');
            });
        });

        // Handle Delete
        $(document).on('click', '[data-action="delete"]', function() {
            var url = $(this).data('url');
            $.get(url, { ajax: true }, function(data) {
                $('#modal-form .modal-content').html(data.html);
                $('#modal-form').modal('show');
            });
        });
    });
</script>
{% endblock %}
